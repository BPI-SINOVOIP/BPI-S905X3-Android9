
//----------------------------------------------------------------------------
// The confidential and proprietary information contained in this file may
// only be used by a person authorised under and to the extent permitted
// by a subsisting licensing agreement from ARM Limited or its affiliates.
//
//          (C) COPYRIGHT 2018 ARM Limited or its affiliates.
//                        ALL RIGHTS RESERVED
//
// This entire notice must be reproduced on all copies of this file
// and copies of this file may only be made by a person if such person is
// permitted to do so under the terms of a subsisting license agreementv
// from ARM Limited or its affiliates.
//----------------------------------------------------------------------------

!function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[i]={exports:{}};t[i][0].call(f.exports,function(e){var n=t[i][1][e];return a(n||e)},f,f.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,n){!function(){var e=document.querySelectorAll("template");if(0!==e.length){for(var t=!0,n=0;n<e.length;n++)if(0!==e[n].childNodes.length){t=!1;break}if(!t)for(var r=0;r<e.length;r++){for(var a=e[r].childNodes,o=0;o<a.length;o++)e[r].content.appendChild(a[o].cloneNode(!0));for(;e[r].hasChildNodes();)e[r].removeChild(e[r].childNodes[0])}}}()},{}],2:[function(e,t,n){var r=arguments[3],a=arguments[4],o=arguments[5],i=JSON.stringify;t.exports=function(e,t){function n(e){v[e]=!0;for(var t in a[e][1]){var r=a[e][1][t];v[r]||n(r)}}for(var s,l=Object.keys(o),c=0,f=l.length;c<f;c++){var u=l[c],d=o[u].exports;if(d===e||d&&d.default===e){s=u;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var p={},c=0,f=l.length;c<f;c++)p[u=l[c]]=u;a[s]=[Function(["require","module","exports"],"("+e+")(self)"),p]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),h={};h[s]=s,a[g]=[Function(["require"],"var f = require("+i(s)+");(f.default ? f.default : f)(self);"),h];var v={};n(g);var m="("+r+")({"+Object.keys(v).map(function(e){return i(e)+":["+a[e][0]+","+i(a[e][1])+"]"}).join(",")+"},{},["+i(g)+"])",w=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return y;var b=w.createObjectURL(y),L=new Worker(b);return L.objectURL=b,L}},{}],3:[function(e,t,n){String.prototype.includes||(String.prototype.includes=function(){"use strict";return-1!==String.prototype.indexOf.apply(this,arguments)}),String.prototype.padLeft||(String.prototype.padLeft=function(){"use strict";var e=arguments[0];if("string"==typeof e){if(null===this||void 0===this)return e;var t=e.length;return(e+this).slice(-t)}return this}),String.prototype.padRight||(String.prototype.padRight=function(){"use strict";var e=arguments[0];if("string"==typeof e){if(null===this||void 0===this)return e;var t=e.length;return(this+e).substring(0,t)}return this}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString(),r=t;(void 0===t||t>n.length)&&(r=n.length),r-=e.length;var a=n.indexOf(e,r);return-1!==a&&a===r}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.contains=function(e){return this.indexOf(e)>=0},Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2}},{}],4:[function(e,t,n){function r(){var e=a("#commands-select"),t=a("#calibrations-select"),n=a("#file-select"),r=a("#image-converter-file-select");e&&e.addEventListener("change",function(e){C(e,p.COMMANDS,!1)},!1),t&&t.addEventListener("change",function(e){C(e,p.CALIBRATIONS_TO_BIN,!0)},!1),n&&n.addEventListener("change",function(e){C(e,p.CALIBRATIONS_TO_C,!0)},!1),r&&(r.addEventListener("click",function(){document.getElementById("image-converter-file-select").value=null}),r.addEventListener("change",function(e){h.cleanUp(),h.files=[],document.querySelector(".toolbar.footer").classList.remove("hidden");for(var t=e.target.files||e.dataTransfer.files,n=0;n<t.length;n++){var r=t[n],a=new FileReader;a.onload=function(e){var t=e.name.toLowerCase().split("."),n=t[t.length-1];if(n in g){var r=g[n];return b(e.name,r)}return h.unknownFormat(e.name)}(r),a.readAsArrayBuffer(r)}},!1),document.getElementById("download-all").addEventListener("click",function(){document.querySelector("#tar-progress").classList.remove("hidden"),downloadTar("images.tar",h.files)}));var o=a("#override-depth"),i=a("#actual-depth");o.checked=!1,o.addEventListener("change",function(e){o.checked?i.classList.remove("disabled"):i.classList.add("disabled")});var s=function(e){var t=a("#actual-depth");y(t.value)?a("#actual-depth").classList.remove("error"):a("#actual-depth").classList.add("error")};i.addEventListener("change",s),i.addEventListener("keypress",s)}e("../fixme"),e("../polyfill");var a=e("../utils/helper"),o=e("../utils/promise"),i=e("../lib/webworkify"),s=e("../workers/bin"),l=e("../workers/jsn"),c=1,f={},u=[],d={},p={CALIBRATIONS_TO_BIN:"calibrations_to_bin",CALIBRATIONS_TO_C:"calibrations_to_c",COMMANDS:"commands"},g={rgb:e("../workers/rgb"),raw:e("../workers/raw"),yuv:e("../workers/yuv")},h={cleanUp:function(){a(".messages").innerHTML="",c=1,f={},u.forEach(URL.revokeObjectURL),u=[],Array.prototype.slice.call(a.$(".button")).forEach(function(e){e.classList.add("disabled")})},getLink:function(e,t,n,r,a){var o=e+"-"+n,i=document.createElement("a");i.id=o,i.download=a||t+"."+e.toLowerCase(),i.textContent=a||e.toUpperCase();var s="function"==typeof r?r():r;f[o]=s;var l=URL.createObjectURL(s);return u.push(l),i.href=l,Promise.resolve(i)},getMessageEntry:function(e,t,n){var r=a("#template").content;r.querySelector(".fname").innerHTML=e,t&&r.querySelector(".clickable").setAttribute("ref",t);var o=r.cloneNode(!0),i=o.querySelector(".display");return n?(i.innerHTML=n,i.classList.add("error")):i.querySelector(".progress").setAttribute("ref",t),o},nextId:function(e){var t=c++;return a(".messages").appendChild(h.getMessageEntry(e,t)),t},unknownFormat:function(e){return function(){a(".messages").appendChild(h.getMessageEntry(e,null,"unsupported format"))}},getBlobs:function(){return f},files:[]},v=function(e,t){return h.getLink("ppm",e.file,e.id,t)},m=function(e){var t=o.defer(),n=document.createElement("canvas");n.width=e.w,n.height=e.h;for(var r=n.getContext("2d"),i=r.getImageData(0,0,parseInt(e.w),parseInt(e.h)),s=i.data,l=e.jpg,c=0,f=l.length;c<f;c++)s[c]=l[c];return r.putImageData(i,0,0),n.toBlob?n.toBlob(function(e){t.resolve(e)},"image/jpeg",parseFloat(a("#jpg-quality").value)):t.reject("Unable to create JPEG file: feature not supported"),t.promise},w=function(e,t){return h.getLink("jpg",e.file,e.id,t)},y=function(e){return/^[0-9]+$/.test(e)},b=function(e,t){return function(n){var r=h.nextId(e),o=a('.progress[ref="'+r+'"]'),s=i(t);s.onmessage=function(e){var t=e.data;if(t.done){o.value=100;var n=a('.clickable[ref="'+r+'"]');if(a("#jpg-gen").checked&&m(t).then(function(e){return h.files.push(new File([e],t.file+".jpg")),w(t,e)}).then(function(e){n.appendChild(e),document.getElementById("download-all").classList.remove("disabled")}),a("#ppm-gen").checked){var i=new Blob(["P6\n"+t.w+" "+t.h+"\n"+t.m+"\n",t.ppm],{type:"image/x-portable-pixmap"});h.files.push(new File([i],t.file+".ppm")),v(t,i).then(function(e){n.appendChild(e),document.getElementById("download-all").classList.remove("disabled")})}}else o.value=t.progress},s.onerror=function(e){var t=o.parentNode;t.innerHTML=e.message,t.classList.add("error")};var l=a("#actual-depth"),c=0;if(a("#override-depth").checked){if(!y(l.value))return void l.classList.add("error");l.classList.remove("error"),c=parseInt(l.value)}s.postMessage([n.target.result,r,e,a("#jpg-gen").checked,a("#ppm-gen").checked,c])}},L=function(e,t,n){if(d){var r,o=h.nextId(e),c=a('.progress[ref="'+o+'"]');if(n===p.CALIBRATIONS_TO_BIN)r=i(s);else{if(n!==p.CALIBRATIONS_TO_C)return;r=i(l)}r.onmessage=function(t){var r=t.data;r.done?(c.value=100,n===p.CALIBRATIONS_TO_BIN?h.getLink("bin",r.name,o.toString(),function(){return new Blob([r.bin],{type:"application/octet-stream"})},r.name).then(function(e){a('.clickable[ref="'+o+'"]').appendChild(e)}):n===p.CALIBRATIONS_TO_C&&h.getLink("c",e,o.toString(),function(){return new Blob([r.cpp],{type:"text/x-c"})},e.replace(/\.[^.]*$/,".c")).then(function(e){a('.clickable[ref="'+o+'"]').appendChild(e)})):c.value=r.progress},r.onerror=function(e){var t=c.parentNode;t.innerHTML=e.message,t.classList.add("error")},r.postMessage([t,o,e,d])}},I=function(e,t){var n=new FileReader;n.onload=function(e){var n=e.name.toLowerCase();return n.endsWith(".json")?t===p.COMMANDS?function(e){d=e.target.result}:t===p.CALIBRATIONS_TO_C||t===p.CALIBRATIONS_TO_BIN?function(e){L(n,e.target.result,t)}:h.unknownFormat(e.name):h.unknownFormat(e.name)}(e),n.readAsText(e)},C=function(e,t,n){h.cleanUp();var r=e.target.files||e.dataTransfer.files;if(n)for(var a=0;a<r.length;a++)I(r[a],t);else{if(1!==r.length)return;I(r[0],t)}};"complete"===document.readyState||"interactive"===document.readyState?r():document.addEventListener("DOMContentLoaded",r)},{"../fixme":1,"../lib/webworkify":2,"../polyfill":3,"../utils/helper":5,"../utils/promise":6,"../workers/bin":7,"../workers/jsn":8,"../workers/raw":9,"../workers/rgb":10,"../workers/yuv":11}],5:[function(e,t,n){t.exports=document.querySelector.bind(document),t.exports.$=document.querySelectorAll.bind(document)},{}],6:[function(e,t,n){t.exports.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}},{}],7:[function(e,t,n){var r=function(e,t,n,r,a){var o=parseInt(e);return 4===t?(a||n.setUint32(r,o,!0),r+4):2===t?(a||n.setUint16(r,o,!0),r+2):(a||n.setUint8(r,o),r+1)},a=function(e,t){return t.hasOwnProperty(e)?parseInt(t[e].value):-1},o=function(e,t,n,a,o,i){var s=r(287454020,4,e,t,i);s=r(o,4,e,s,i);for(var l=0,c=a.length;l<c;l++)s=r(a[l],n,e,s,i);return s},i=function(e,t,n,r,a){var i=parseInt(e.width);return o(n,r,i,e.value,t,a)};t.exports=function(e){e.onmessage=function(t){var n,o=JSON.parse(t.data[0]),s=JSON.parse(t.data[3]),l="static_calibrations"in s?s.static_calibrations:s.calibration,c="dynamic_calibrations"in s?s.dynamic_calibrations:s.calibration_isp,f=o.target;n="sensor"===f?"static.bin":"isp"===f?"dynamic.bin":f.replace(/[^a-z0-9]+/g,"-")+".bin";var u={};for(var d in l)l.hasOwnProperty(d)&&(u[d]=l[d]);for(var p in c)c.hasOwnProperty(p)&&(u[p]=c[p]);for(var g,h,v,m=null,w=0,y=o.luts,b=0,L=y.length;b<L;b++){if(g=y[b],h=g.name,-1===(v=a(h,u)))throw new Error("failed to find id for lut "+h);w=i(g,v,m,w,!0),b%8==0&&e.postMessage({progress:40*b/L})}var I=r(4294967295,4,m,w,!0),C=new ArrayBuffer(I);for(m=new DataView(C),w=0,b=0;b<L;b++){if(g=y[b],h=g.name,-1===(v=a(h,u)))throw new Error("failed to find id for lut "+h);w=i(g,v,m,w),b%8==0&&e.postMessage({progress:40+60*b/L})}r(4294967295,4,m,w),e.postMessage({done:!0,name:n,bin:C})}}},{}],8:[function(e,t,n){var r=function(){return"/**\n *  The confidential and proprietary information contained in this file may\n *   only be used by a person authorised under and to the extent permitted\n *  by a subsisting licensing agreement from ARM Limited or its affiliates.\n *\n *        (C) COPYRIGHT "+(new Date).getFullYear()+" ARM Limited or its affiliates\n *                       ALL RIGHTS RESERVED\n *\n *       This entire notice must be reproduced on all copies of this file\n *   and copies of this file may only be made by a person if such person is\n *    permitted to do so under the terms of a subsisting license agreement\n *                  from ARM Limited or its affiliates.\n *\n */ \n"},a=function(e){switch(e){case 1:return"uint8_t";case 2:return"uint16_t";case 4:return"uint32_t";default:throw new Error("Bad width of integer variable")}},o=function(e){var t="_"+e.name.toLowerCase(),n=parseInt(e.rows),r=parseInt(e.cols),o=parseInt(e.width),i=e.value,s=e.name+" ("+n+"x"+r+" "+o+" bytes)";e.hasOwnProperty("__comment")&&(s=e.__comment);var l,c;if(1===n)c=JSON.stringify(i).replace(/\[/g,"{").replace(/]/g,"}");else{var f=0;c=" {";for(var u=0;u<n;u++){l="\n  { ";for(var d=0;d<r;d++)l+=i[f]+", ",f+=1;c+=l=l.replace(/, $/," },")}c=c.replace(/,$/,"\n}")}var p="\n\n// "+s+"\nstatic "+a(o)+" "+t;return p+=1===n?"[]\n":"[]["+r+"]\n",p+=" = "+c+";"},i=function(){var e='#include "apical_types.h"\n';return e+='#include "apical_command_api.h"\n',e+='#include "apical_firmware_api.h"\n',e+="\n"};t.exports=function(e){e.onmessage=function(t){var n=JSON.parse(t.data[0]),a=t.data[1],s=t.data[2],l=n.target,c=n.luts,f=r();f+="\n",f+=i(),f+="// created from "+(new Date).toISOString()+" UTC"+s;for(var u=0,d=c.length;u<d;u++)f+=o(c[u]),e.postMessage({id:a,progress:40*u/d});var p,g,h,v;f+="\n";for(var m=0;m<d;m++)g=(p=c[m]).name.toLowerCase(),h=parseInt(p.rows),v=parseInt(p.cols),parseInt(p.width),p.value,f+=1===h?"\nstatic LookupTable "+g+" = { .ptr = _"+g+", .rows = "+h+", .cols = sizeof(_"+g+") / sizeof(_"+g+"[0]), .width = sizeof(_"+g+"[0] ) };":"\nstatic LookupTable "+g+" = { .ptr = _"+g+", .cols = "+v+", .rows = sizeof(_"+g+") / sizeof(_"+g+"[0]), .width = sizeof(_"+g+"[0][0] ) };",e.postMessage({id:a,progress:40+30*u/d});f+="\n\n";f+="uint32_t get_"+("isp"===l.toLowerCase()?"dynamic":"sensor"===l.toLowerCase()?"static":l.toLowerCase().replace(/[^a-z0-9]+/g,"_"))+"( ApicalCalibrations * c ) {\n",f+="    uint32_t result = 0;\n",f+="    if (c != 0) {\n";for(var w=0;w<d;w++)g=(p=c[w]).name.toLowerCase(),f+="        c->calibrations["+p.name+"] = &"+g+";\n",e.postMessage({id:a,progress:70+30*u/d});f+="    } else {\n",f+="        result = -1;\n",f+="    }\n",f+="    return result;\n",f+="}\n",e.postMessage({id:a,done:!0,file:s,cpp:f})}}},{}],9:[function(e,t,n){t.exports=function(e){e.onmessage=function(t){for(var n,r=t.data[0],a=t.data[1],o=t.data[2],i=t.data[3],s=t.data[4],l=t.data[5],c=new DataView(r,15),f=0,u="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)u+=n;u=parseInt(u);for(var d="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)d+=n;d=parseInt(d);for(var p="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)p+=n;if(l>0)var g=Math.pow(2,l)-1,h=parseInt(l);else var g=parseInt(p),h=parseInt(Math.log2(g+1));var v=16-h;if(v<0)throw new Error("image data depth is more than 16 bits");var m,w,y,b=Math.log2(g+1>>8),L=4*u,I=parseInt(u>>1),C=parseInt(d>>1),S=0,_=0,M=0,O=0,k=0;if(s)var A=new ArrayBuffer(6*C*I),U=new DataView(A);if(i)var T=new Uint8ClampedArray(4*C*I,null,null);for(w=0;w<C;w++){for(m=0;m<u;m++)m<I&&(M=((O=c.getUint32(f,!0))>>0&65535)>>v,S=((k=c.getUint32(L+f,!0))>>16&65535)>>v,_=(((O>>16&65535)>>v)+((k>>0&65535)>>v))/2,s&&(y=6*(w*I+m),U.setUint16(y+0,S),U.setUint16(y+2,_),U.setUint16(y+4,M)),i&&(T[(y=4*(w*I+m))+0]=S>>b,T[y+1]=_>>b,T[y+2]=M>>b,T[y+3]=255)),f+=4;f+=L,w%256==0&&e.postMessage({id:a,progress:100*w/C})}e.postMessage({id:a,done:!0,ppm:s?A:null,jpg:i?T:null,w:I,h:C,m:g,file:o})}}},{}],10:[function(e,t,n){t.exports=function(e){e.onmessage=function(t){for(var n,r=t.data[0],a=t.data[1],o=t.data[2],i=t.data[3],s=t.data[4],l=t.data[5],c=new DataView(r,15),f=0,u="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)u+=n;u=parseInt(u);for(var d="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)d+=n;d=parseInt(d);for(var p="";f<c.byteLength&&(n=String.fromCharCode(c.getInt8(f)),f++," "!==n&&"\n"!==n);)p+=n;p=parseInt(p);var g=parseInt(p+1);if(l>0)p=Math.pow(2,l)-1,h=l;else{if((g&-g)!==g)throw new Error("bad data depth: max value is "+p+" but should be 2^n - 1");var h=Math.log2(g)}var v=Math.log2(p+1>>8),m=0,w=0,y=0,b=0;if(s)var L=new ArrayBuffer(6*d*u),I=new DataView(L);var C,S,_;if(i)var M=new Uint8ClampedArray(4*d*u,null,null);for(S=0;S<d;S++){for(C=0;C<u;C++)b=c.getUint32(f,!0),f+=4,m=b>>2*h&p,w=b>>h&p,y=b>>0&p,s&&(_=6*(S*u+C),I.setUint16(_+0,m),I.setUint16(_+2,w),I.setUint16(_+4,y)),i&&(M[(_=4*(S*u+C))+0]=m>>v,M[_+1]=w>>v,M[_+2]=y>>v,M[_+3]=255);S%256==0&&e.postMessage({id:a,progress:100*S/d})}e.postMessage({id:a,done:!0,ppm:s?L:null,jpg:i?M:null,w:u,h:d,m:p,file:o})}}},{}],11:[function(e,t,n){t.exports=function(e){e.onmessage=function(t){for(var n,r=t.data[0],a=t.data[1],o=t.data[2],i=t.data[3],s=t.data[4],l=new DataView(r,15),c=0,f="";c<l.byteLength&&(n=String.fromCharCode(l.getInt8(c)),c++," "!==n&&"\n"!==n);)f+=n;f=parseInt(f);for(var u="";c<l.byteLength&&(n=String.fromCharCode(l.getInt8(c)),c++," "!==n&&"\n"!==n);)u+=n;u=parseInt(u);for(var d="";c<l.byteLength&&(n=String.fromCharCode(l.getInt8(c)),c++," "!==n&&"\n"!==n);)d+=n;var p=parseInt(d);if(s)var g=new ArrayBuffer(6*u*f),h=new DataView(g);if(i)var v=new Uint8ClampedArray(4*u*f,null,null);var m,w,y,b,L,I,C,S,_,M,O,k,A,U,T;for(w=0;w<u;w++){for(m=0;m<f;m+=2)y=l.getUint32(c+0,!0),b=l.getUint32(c+4,!0),c+=8,L=y>>6&1023,C=y>>22&1023,I=b>>6&1023,S=b>>22&1023,_=parseInt(1*L*(C-256)+1.4*(S-256)),M=parseInt(1*L-.343*(C-256)-.711*(S-256)),O=parseInt(1*L+1.765*(C-256)-0*(S-256)),k=parseInt(1*I*(C-256)+1.4*(S-256)),A=parseInt(1*I-.343*(C-256)-.711*(S-256)),U=parseInt(1*I+1.765*(C-256)-0*(S-256)),s&&(T=6*(w*f+m),h.setUint16(T+0,_),h.setUint16(T+2,M),h.setUint16(T+4,O),T=6*(w*f+m+1),h.setUint16(T+0,k),h.setUint16(T+2,A),h.setUint16(T+4,U)),i&&(v[(T=4*(w*f+m))+0]=_>>2,v[T+1]=M>>2,v[T+2]=O>>2,v[T+3]=255,v[(T=4*(w*f+m+1))+0]=k>>2,v[T+1]=A>>2,v[T+2]=U>>2,v[T+3]=255);w%256==0&&e.postMessage({id:a,progress:100*w/u})}e.postMessage({id:a,done:!0,ppm:s?g:null,jpg:i?v:null,w:f,h:u,m:p,file:o})}}},{}]},{},[4]);