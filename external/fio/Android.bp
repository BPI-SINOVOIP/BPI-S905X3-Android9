cc_defaults {
    name: "fio_defaults",
    cflags: [
        "-DFIO_VERSION=\"fio-2.20\"",
        "-DCONFIG_3ARG_AFFINITY",
        "-DCONFIG_CLOCK_GETTIME",
        "-DCONFIG_CLOCK_MONOTONIC",
        "-DCONFIG_FDATASYNC",
        "-DCONFIG_GETOPT_LONG_ONLY",
        "-DCONFIG_GETTIMEOFDAY",
        "-DCONFIG_IPV6",
        "-DCONFIG_LINUX_FALLOCATE",
        "-DCONFIG_LINUX_SPLICE",
        "-DCONFIG_LITTLE_ENDIAN",
        "-DCONFIG_PSHARED",
        "-DCONFIG_RLIMIT_MEMLOCK",
        "-DCONFIG_RUSAGE_THREAD",
        "-DCONFIG_SCHED_IDLE",
        "-DCONFIG_SETVBUF",
        "-DCONFIG_SFAA",
        "-DCONFIG_SOCKLEN_T",
        "-DCONFIG_STRCASESTR",
        "-DCONFIG_STRLCAT",
        "-DCONFIG_STRSEP",
        "-DCONFIG_TCP_NODELAY",
        "-DCONFIG_TLS_THREAD",
        "-DCONFIG_ZLIB",
        "-DFIO_HAVE_CGROUPS",
        "-DFIO_INC_DEBUG",
        "-DFIO_INTERNAL",
        "-D_FILE_OFFSET_BITS=64",
        "-O3",
        "-Wall",
        "-Werror",
        "-Wdeclaration-after-statement",
        "-Wwrite-strings",
        "-ffast-math",
        "-fno-omit-frame-pointer",
        "-std=gnu99",
        "-Wno-macro-redefined",
        "-Wno-missing-field-initializers",
        "-Wno-pointer-arith",
        "-Wno-sign-compare",
        "-Wno-unused-parameter",
        "-Wno-unused-variable",
        "-include sys/sysmacros.h",
    ],

    multilib: {
        lib32: {
            cflags: [
                "-DBITS_PER_LONG=32",
                "-DCONFIG_32BIT",
            ],
        },
        lib64: {
            cflags: [
                "-DBITS_PER_LONG=64",
                "-DCONFIG_64BIT",
            ],
        },
    },
    arch: {
        mips: {
            enabled: false,
        },
        mips64: {
            enabled: false,
        },
    },

    tidy_checks: ["-clang-analyzer*"],
}

cc_binary {
    name: "fio",
    defaults: ["fio_defaults"],
    shared_libs: ["libdl"],
    static_libs: [
        "libcutils",
        "libz",
    ],
    srcs: [
        "backend.c",
        "blktrace.c",
        "cconv.c",
        "cgroup.c",
        "client.c",
        "debug.c",
        "diskutil.c",
        "eta.c",
        "fifo.c",
        "filehash.c",
        "filelock.c",
        "filesetup.c",
        "fio.c",
        "flow.c",
        "gettime.c",
        "gettime-thread.c",
        "helpers.c",
        "helper_thread.c",
        "idletime.c",
        "init.c",
        "ioengines.c",
        "iolog.c",
        "io_u.c",
        "io_u_queue.c",
        "json.c",
        "libfio.c",
        "log.c",
        "memory.c",
        "mutex.c",
        "optgroup.c",
        "options.c",
        "parse.c",
        "profile.c",
        "rate-submit.c",
        "server.c",
        "smalloc.c",
        "stat.c",
        "steadystate.c",
        "td_error.c",
        "tickmarks.c",
        "time.c",
        "trim.c",
        "verify.c",
        "workqueue.c",
        "crc/*.c",
        "engines/cpu.c",
        "engines/mmap.c",
        "engines/null.c",
        "engines/net.c",
        "engines/sg.c",
        "engines/splice.c",
        "engines/sync.c",
        "lib/*.c",
        "oslib/linux-dev-lookup.c",
    ],
}
